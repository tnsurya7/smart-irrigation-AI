# Render.com deployment configuration
services:
  # Backend API Service
  - type: web
    name: smart-agriculture-backend
    env: python
    buildCommand: "pip install -r backend/requirements.txt"
    startCommand: "cd backend && python production_backend.py"
    plan: starter
    region: oregon
    branch: main
    healthCheckPath: /health
    envVars:
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false
      - key: OPENWEATHER_API_KEY
        sync: false
      - key: TELEGRAM_BOT_TOKEN
        sync: false
      - key: TELEGRAM_CHAT_ID
        sync: false
      - key: ALLOWED_ORIGINS
        value: "https://smart-agriculture-dashboard.vercel.app"
      - key: NODE_ENV
        value: "production"
      - key: HOST
        value: "0.0.0.0"
      - key: PORT
        value: "8000"

  # WebSocket Service
  - type: web
    name: smart-agriculture-websocket
    env: python
    buildCommand: "pip install -r backend/requirements.txt"
    startCommand: "cd backend && python production_websocket.py"
    plan: starter
    region: oregon
    branch: main
    healthCheckPath: /health
    envVars:
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false
      - key: ALLOWED_ORIGINS
        value: "https://smart-agriculture-dashboard.vercel.app"
      - key: NODE_ENV
        value: "production"
      - key: WS_HOST
        value: "0.0.0.0"
      - key: WS_PORT
        value: "8080"

  # Background Worker for Telegram Bot
  - type: worker
    name: smart-agriculture-telegram
    env: python
    buildCommand: "pip install -r backend/requirements.txt"
    startCommand: "python telegram_bot_simple.py"
    plan: starter
    region: oregon
    branch: main
    envVars:
      - key: TELEGRAM_BOT_TOKEN
        sync: false
      - key: TELEGRAM_CHAT_ID
        sync: false
      - key: OPENWEATHER_API_KEY
        sync: false
      - key: VITE_WS_URL
        value: "wss://smart-agriculture-websocket.onrender.com/ws"
      - key: VITE_API_BASE_URL
        value: "https://smart-agriculture-backend.onrender.com"
      - key: WEATHER_CITY
        value: "Erode"